# –†–µ—à–µ–Ω–∏–µ: SSL Error –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ PostgreSQL

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É:

```
psycopg.OperationalError: failed to consume input: SSL error: decryption failed or bad record mac

sqlalchemy.exc.OperationalError: (psycopg.OperationalError) failed to consume input: SSL error: decryption failed or bad record mac
```

**–ì–¥–µ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:**
- ‚ùå POST /login - –æ—à–∏–±–∫–∞ 500
- ‚ùå POST /register - –æ—à–∏–±–∫–∞ 500  
- ‚ùå –õ—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã (`db.create_all()` —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚ùå **–ó–ê–ü–†–û–°–´ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–∑-–∑–∞ SSL**

## üéØ –ü—Ä–∏—á–∏–Ω–∞

Render PostgreSQL —Ç—Ä–µ–±—É–µ—Ç **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**, –Ω–æ –≤ —Å—Ç—Ä–æ–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω—ã SSL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```
postgresql+psycopg://user:pass@host/db
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```
postgresql+psycopg://user:pass@host/db?sslmode=require
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –°–ø–æ—Å–æ–± 1: –û–±–Ω–æ–≤–∏—Ç—å Environment Variable –≤ Render Dashboard (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Render Dashboard:**
   - https://dashboard.render.com
   - –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å `marketing-agent`

2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Environment:**
   - –ù–∞–∂–º–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É "Environment" –≤ –ª–µ–≤–æ–º –º–µ–Ω—é

3. **–ù–∞–π–¥–∏—Ç–µ SQLALCHEMY_DATABASE_URI:**
   - Scroll –¥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `SQLALCHEMY_DATABASE_URI`

4. **–ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ:**
   
   **‚ùå –°—Ç–∞—Ä–æ–µ (–±–µ–∑ SSL):**
   ```
   postgresql+psycopg://ittoken_db_user:Xm98VVSZv7cMJkopkdWRkgvZzC7Aly42@dpg-d0visga4d50c73ekmu4g-a/ittoken_db
   ```
   
   **‚úÖ –ù–æ–≤–æ–µ (—Å SSL):**
   ```
   postgresql+psycopg://ittoken_db_user:Xm98VVSZv7cMJkopkdWRkgvZzC7Aly42@dpg-d0visga4d50c73ekmu4g-a/ittoken_db?sslmode=require
   ```
   
   **–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:** `?sslmode=require` –≤ –∫–æ–Ω–µ—Ü URL

5. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   - –ù–∞–∂–º–∏—Ç–µ "Save Changes"
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è (30-60 —Å–µ–∫—É–Ω–¥)

6. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ https://marketing-agent-p4ig.onrender.com/register
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
   - –û—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å!

### –°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

Render –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ URL –¥–ª—è PostgreSQL:
- **External URL** (–¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π) - —Ç—Ä–µ–±—É–µ—Ç SSL
- **Internal URL** (–¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å Render —Å–µ—Ä–≤–∏—Å–æ–≤) - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç SSL

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Internal URL:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ Render Dashboard ‚Üí Databases
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `ittoken_db`
3. –ù–∞–π–¥–∏—Ç–µ **Internal Database URL**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç URL
5. –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ SQLALCHEMY_DATABASE_URI (–¥–æ–±–∞–≤–∏–≤ `+psycopg`)

–ü—Ä–∏–º–µ—Ä:
```
postgresql+psycopg://ittoken_db_user:password@dpg-xxx-a.oregon-postgres.render.com/ittoken_db
```

### –°–ø–æ—Å–æ–± 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL Engine Options (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π)

–ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `?sslmode=require` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSL —á–µ—Ä–µ–∑ SQLAlchemy engine options.

–û—Ç–∫—Ä–æ–π—Ç–µ `app/__init__.py` –∏ –Ω–∞–π–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```python
# –î–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è db
app.config['SQLALCHEMY_ENGINE_OPTIONS'] = {
    'connect_args': {
        'sslmode': 'require',
        'sslrootcert': '/etc/ssl/certs/ca-certificates.crt'  # –î–ª—è Linux
    }
}
```

## üîß SSL Modes (—É—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã)

PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã SSL:

| Mode | –û–ø–∏—Å–∞–Ω–∏–µ | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
|------|----------|--------------|
| `disable` | –ë–µ–∑ SSL | ‚ùå –ù–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ |
| `allow` | SSL –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω | ‚ö†Ô∏è –°–ª–∞–±–∞—è |
| `prefer` | –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç SSL | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è |
| `require` | –¢—Ä–µ–±—É–µ—Ç SSL | ‚úÖ –•–æ—Ä–æ—à–∞—è |
| `verify-ca` | SSL + –ø—Ä–æ–≤–µ—Ä–∫–∞ CA | ‚úÖ –í—ã—Å–æ–∫–∞—è |
| `verify-full` | SSL + –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è |

**–î–ª—è Render.com —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** `sslmode=require`

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ Render:**
   ```
   [INFO] Starting gunicorn 21.2.0
   [INFO] Listening at: http://0.0.0.0:10000
   ‚úÖ Database tables verified/created successfully!
   ```

2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è:**
   - https://marketing-agent-p4ig.onrender.com/register
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É
   - –ù–∞–∂–º–∏—Ç–µ "Registrieren"

3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```
   ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!
   ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /dashboard
   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö:**
   ```
   10.201.139.5 - - [08/Oct/2025:13:35:00 +0000] "POST /register HTTP/1.1" 302
   10.201.139.5 - - [08/Oct/2025:13:35:01 +0000] "GET /dashboard HTTP/1.1" 200
   ```
   - `302` = —É—Å–ø–µ—à–Ω—ã–π redirect
   - `200` = —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å

## üö® –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. –ó–∞–±—ã–ª–∏ `+psycopg` –≤ URL
```
‚ùå postgresql://user:pass@host/db?sslmode=require
‚úÖ postgresql+psycopg://user:pass@host/db?sslmode=require
```

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```
‚ùå postgresql+psycopg://...?ssl=true
‚ùå postgresql+psycopg://...&sslmode=require
‚úÖ postgresql+psycopg://...?sslmode=require
```

### 3. –ü—Ä–æ–±–µ–ª—ã –≤ URL
```
‚ùå postgresql+psycopg://... ?sslmode=require
‚úÖ postgresql+psycopg://...?sslmode=require
```

### 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –†–µ—à–µ–Ω–∏–µ: –°–¥–µ–ª–∞–π—Ç–µ "Manual Deploy" ‚Üí "Clear build cache & deploy"

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü–æ—á–µ–º—É Render —Ç—Ä–µ–±—É–µ—Ç SSL:**
- üîí –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ
- üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ (MITM)
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- üìú –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

**–ß—Ç–æ —à–∏—Ñ—Ä—É–µ—Ç—Å—è:**
- ‚úÖ –õ–æ–≥–∏–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ API –∫–ª—é—á–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –ë–î

## üìù –§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. **Render Dashboard (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):**
   - Environment ‚Üí SQLALCHEMY_DATABASE_URI
   - –î–æ–±–∞–≤–∏—Ç—å `?sslmode=require`

2. **render-env-variables.txt (—É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω):**
   ```
   SQLALCHEMY_DATABASE_URI=postgresql+psycopg://...?sslmode=require
   ```

3. **.env (—É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω):**
   ```
   SQLALCHEMY_DATABASE_URI=postgresql+psycopg://...?sslmode=require
   ```

## üéØ –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ Render  
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞  
‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç  
‚úÖ –î–∏–∑–∞–π–Ω –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –∫—Ä–∞—Å–∏–≤—ã–π  
‚ùå **SSL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ Render Environment**  
‚ùå –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–≤—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç  

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û–±–Ω–æ–≤–∏—Ç–µ SQLALCHEMY_DATABASE_URI –≤ Render Dashboard (–¥–æ–±–∞–≤—å—Ç–µ `?sslmode=require`)

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [PostgreSQL SSL Support](https://www.postgresql.org/docs/current/libpq-ssl.html)
- [psycopg3 Connection Strings](https://www.psycopg.org/psycopg3/docs/basic/params.html)
- [Render PostgreSQL SSL](https://render.com/docs/databases#ssl-connections)
- [SQLAlchemy Engine Configuration](https://docs.sqlalchemy.org/en/20/core/engines.html)

---

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –±–µ–∑ —ç—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è  
**–í—Ä–µ–º—è —Ä–µ—à–µ–Ω–∏—è:** 2 –º–∏–Ω—É—Ç—ã (–∏–∑–º–µ–Ω–∏—Ç—å –æ–¥–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é)  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ (–¥–æ–±–∞–≤–∏—Ç—å `?sslmode=require`)
